<!DOCTYPE html>
<html lang="en">

<head>
  <title>Janne Lavila - Software Engineer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/normalize.css?ver=11" />
  <link rel="stylesheet" href="css/main.css?ver=11" />
  <link rel="stylesheet" href="css/photography.css?ver=11" />
  <script type="module" src="js/index.js?ver=11"></script>
</head>

<body>
  <nav>
    <nav-content currentpage="photography">
      <div class="loading-bar"></div>
    </nav-content>
  </nav>
  <main>
    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source
            srcset="img/640-appletreeflower.webp 640w, img/1600-appletreeflower.webp 1600w, img/1920-appletreeflower.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-appletreeflower.webp" loading="lazy" decoding="async"
            alt="A flowering branch of an apple tree with a wasp flying next to it" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image displayed fadein">
          <img src="img/1920-appletreeflower.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source
            srcset="img/640-velvetflower.webp 640w, img/1600-velvetflower.webp 1600w, img/1920-velvetflower.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-velvetflower.webp" loading="lazy" decoding="async"
            alt="A centered image of a velvety flower" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image displayed">
          <img src="img/1920-velvetflower.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-amanita.webp 640w, img/1600-amanita.webp 1600w, img/1920-amanita.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-amanita.webp" loading="lazy" decoding="async" alt="A fly agaric in stark sun light" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-amanita.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-snowapple.webp 640w, img/1600-snowapple.webp 1600w, img/1920-snowapple.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-snowapple.webp" loading="lazy" decoding="async"
            alt="An apple tree covered in a snowy dream scape" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-snowapple.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-bumblebee.webp 640w, img/1600-bumblebee.webp 1600w, img/1920-bumblebee.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-bumblebee.webp" loading="lazy" decoding="async" alt="A bumble bee resting on a dandelion" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-bumblebee.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-butterfly.webp 640w, img/1600-butterfly.webp 1600w, img/1920-butterfly.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-butterfly.webp" loading="lazy" decoding="async" alt="A butterfly resting on a green plant" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-butterfly.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-moth.webp 640w, img/1600-moth.webp 1600w, img/1920-moth.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-moth.webp" loading="lazy" decoding="async" alt="A moth looking over a field of grass" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-moth.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>

    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-withered.webp 640w, img/1600-withered.webp 1600w, img/1920-withered.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-withered.webp" loading="lazy" decoding="async" alt="A withered flower in black and white" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-withered.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>
    
    <section>
      <article>
        <header class="y-offset">
          hello
        </header>
        <picture class="article-picture">
          <source srcset="img/640-boletus.webp 640w, img/1600-boletus.webp 1600w, img/1920-boletus.webp 1920w"
            sizes="(max-width: 640px) 640px, (max-width: 1600px) 1600px, 1920px" />
          <img src="img/640-boletus.webp" loading="lazy" decoding="async" alt="A mushroom hidden in grass" />
        </picture>
        <section class="y-offset">
          some text
        </section>
        <footer>

        </footer>
        <picture class="background-image">
          <img src="img/1920-boletus.webp" loading="lazy" decoding="async" alt="" />
        </picture>
      </article>
    </section>
  </main>

  <script>
    let elementInView = undefined
    const supportsLazy = 'loading' in HTMLImageElement.prototype
    const observer = new IntersectionObserver(
      handleIntersection,
      { root: document.body, threshold: .8 }
    )

    document.querySelectorAll("main > section").forEach(article => observer.observe(article))

    /**
    * @param entries {IntersectionObserverEntry[]}
    */
    function handleIntersection(entries) {
      const intersectingEntry = entries.find(entry => entry.isIntersecting)
      if (!intersectingEntry) return

      elementInView = intersectingEntry.target

      animateContent(elementInView)

      const img = elementInView.querySelector("img")
      if (supportsLazy && !img.complete) {
        img.addEventListener("load", handleLoad)
      } else {
        handleBackgroundChange()
      }
    }

    /**
    * @this {HTMLImageElement}
    */
    function handleLoad() {
      this.removeEventListener("load", handleBackgroundChange)
      handleBackgroundChange()
    }

    function handleBackgroundChange() {
      fadeOutSurroundingBackgroundImages(elementInView)
      fadeInCurrentBackground(elementInView)
      setNextToBeDisplayed(elementInView)
    }

    /**
    * @param element {Element}
    */
    function fadeOutSurroundingBackgroundImages(element) {
      document.querySelector('.fadein')
        .classList.replace('fadein', 'fadeout')
    }

    /**
    * @param element {Element}
    */
    function fadeInCurrentBackground(element) {
      const backgroundPicture = element.querySelector(".background-image")
      backgroundPicture.classList.remove("fadeout")
      backgroundPicture.classList.add("fadein")
    }

    /**
    * The pictures are set to display: none to leverage the browser's lazy loading
    * capabilities. Set the next picture to be displayed and the browser should load it
    * while the current is being viewed
    *
    * @param element {Element}
    */
    function setNextToBeDisplayed(element) {
      const nextSection = element.nextElementSibling
      if (nextSection instanceof HTMLElement) {
        const nextBackgroundPicture = nextSection.querySelector(".background-image")
        nextBackgroundPicture.classList.add("displayed")
      }
    }

    /**
    * @param element {Element}
    */
    function animateContent(element) {
      element.querySelector(".background-image").classList.add("displayed")
      element.querySelector("header").classList.replace("y-offset", "jump-in")
      element.querySelector("section").classList.replace("y-offset", "jump-in")
      element.querySelector("section").classList.add("delayed")
    }

    /**
     * Set the image on the next artile to load eagerly, so it is ready
     * by the time the user scrolls to it
     * @param element {Element}
    */
    function loadNextArticlePicture(element) {
      element.nextElementSibling
        .querySelector(".article-picture")
        .querySelector("img")
        .setAttribute("loading", "eager")
    }
  </script>
</body>

</html>